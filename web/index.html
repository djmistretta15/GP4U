<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ GP4U - The Kayak of GPUs</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 3rem;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            font-size: 1.2rem;
            color: #e0e7ff;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            text-align: center;
        }

        .stat-card h3 {
            font-size: 0.9rem;
            color: #e0e7ff;
            margin-bottom: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, #ffd700, #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-card .sub {
            font-size: 0.85rem;
            color: #c7d2fe;
            margin-top: 8px;
        }

        .controls {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .controls-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
        }

        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .control-group label {
            font-size: 0.95rem;
            color: #e0e7ff;
            font-weight: 500;
        }

        .btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.4);
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
            font-weight: 500;
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn.active {
            background: #ffd700;
            color: #667eea;
            border-color: #ffd700;
        }

        .btn.refresh {
            background: rgba(76, 175, 80, 0.3);
            border-color: rgba(76, 175, 80, 0.6);
        }

        .btn.refresh:hover {
            background: rgba(76, 175, 80, 0.5);
        }

        .section-title {
            font-size: 1.8rem;
            margin: 40px 0 20px 0;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .gpu-grid {
            display: grid;
            gap: 20px;
            margin-bottom: 40px;
        }

        .gpu-card {
            background: rgba(255, 255, 255, 0.95);
            color: #1a1a2e;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .gpu-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 48px rgba(0, 0, 0, 0.15);
        }

        .gpu-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 2px solid #e5e7eb;
        }

        .gpu-model {
            font-size: 1.5rem;
            font-weight: 700;
            color: #667eea;
        }

        .gpu-vram {
            font-size: 0.9rem;
            color: #6b7280;
            margin-top: 4px;
        }

        .price-badge {
            text-align: right;
        }

        .price-main {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .price-sub {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        .gpu-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 16px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .detail-label {
            font-size: 0.8rem;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .detail-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
        }

        .provider-badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .availability {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .availability.available {
            background: #d1fae5;
            color: #065f46;
        }

        .availability.reserved {
            background: #fee2e2;
            color: #991b1b;
        }

        .price-breakdown {
            background: #f9fafb;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
        }

        .breakdown-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 0.9rem;
        }

        .breakdown-row.total {
            border-top: 2px solid #e5e7eb;
            margin-top: 8px;
            padding-top: 12px;
            font-weight: 700;
            font-size: 1rem;
        }

        .gpu-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .action-btn.deploy {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .action-btn.deploy:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .action-btn.compare {
            background: #e5e7eb;
            color: #374151;
        }

        .action-btn.compare:hover {
            background: #d1d5db;
        }

        .arbitrage-card {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
            color: #78350f;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(251, 191, 36, 0.3);
        }

        .arbitrage-header {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .arbitrage-compare {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
        }

        .arbitrage-provider {
            text-align: center;
        }

        .arbitrage-provider.cheap {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 12px;
            padding: 16px;
        }

        .arbitrage-provider.expensive {
            background: rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 16px;
        }

        .arbitrage-name {
            font-weight: 600;
            margin-bottom: 8px;
        }

        .arbitrage-price {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .arbitrage-arrow {
            font-size: 2rem;
            font-weight: bold;
        }

        .arbitrage-savings {
            text-align: center;
            margin-top: 16px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .loading {
            text-align: center;
            padding: 60px;
            font-size: 1.5rem;
        }

        .empty {
            text-align: center;
            padding: 60px;
            color: #e0e7ff;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .gpu-details {
                grid-template-columns: 1fr;
            }
            
            .arbitrage-compare {
                grid-template-columns: 1fr;
            }
            
            .arbitrage-arrow {
                transform: rotate(90deg);
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function GP4UDashboard() {
            const [stats, setStats] = useState(null);
            const [gpus, setGpus] = useState([]);
            const [arbitrage, setArbitrage] = useState([]);
            const [loading, setLoading] = useState(true);
            const [filterProvider, setFilterProvider] = useState('all');
            const [sortBy, setSortBy] = useState('price');
            const [refreshing, setRefreshing] = useState(false);

            useEffect(() => {
                loadData();
                const interval = setInterval(loadData, 30000);
                return () => clearInterval(interval);
            }, []);

            const loadData = async () => {
                try {
                    const [statsRes, gpusRes, arbRes] = await Promise.all([
                        fetch('/api/dashboard'),
                        fetch('/api/gpus'),
                        fetch('/api/arbitrage')
                    ]);
                    
                    const statsData = await statsRes.json();
                    const gpusData = await gpusRes.json();
                    const arbData = await arbRes.json();
                    
                    setStats(statsData);
                    setGpus(gpusData);
                    setArbitrage(arbData);
                    setLoading(false);
                } catch (error) {
                    console.error('Error loading data:', error);
                    setLoading(false);
                }
            };

            const refreshData = async () => {
                setRefreshing(true);
                try {
                    await fetch('/api/refresh', { method: 'POST' });
                    await loadData();
                } catch (error) {
                    console.error('Error refreshing:', error);
                }
                setRefreshing(false);
            };

            const filteredGpus = gpus
                .filter(g => filterProvider === 'all' || g.provider === filterProvider)
                .filter(g => g.availability === 'Available')
                .sort((a, b) => {
                    if (sortBy === 'price') return a.total_price - b.total_price;
                    if (sortBy === 'uptime') return b.uptime_percent - a.uptime_percent;
                    if (sortBy === 'vram') return b.vram_gb - a.vram_gb;
                    return 0;
                });

            if (loading) {
                return <div className="loading">üöÄ Loading GPU marketplace...</div>;
            }

            return (
                <div className="container">
                    <div className="header">
                        <h1>üöÄ GP4U</h1>
                        <p>The Kayak of GPUs ¬∑ Compare ‚Ä¢ Deploy ‚Ä¢ Save</p>
                    </div>

                    {stats && (
                        <div className="stats-grid">
                            <div className="stat-card">
                                <h3>üíª GPUs Available</h3>
                                <div className="value">{stats.total_listings}</div>
                                <div className="sub">Across {stats.active_providers} networks</div>
                            </div>
                            <div className="stat-card">
                                <h3>üí∞ Average Price</h3>
                                <div className="value">${stats.avg_price}</div>
                                <div className="sub">per hour</div>
                            </div>
                            <div className="stat-card">
                                <h3>üéØ Best Deal</h3>
                                <div className="value">${stats.cheapest_gpu}</div>
                                <div className="sub">per hour</div>
                            </div>
                            <div className="stat-card">
                                <h3>üìà Arbitrage</h3>
                                <div className="value">{stats.best_arbitrage_percent}%</div>
                                <div className="sub">{stats.arbitrage_opportunities} opportunities</div>
                            </div>
                        </div>
                    )}

                    <div className="controls">
                        <div className="controls-row">
                            <div className="control-group">
                                <label>Provider:</label>
                                <button 
                                    className={`btn ${filterProvider === 'all' ? 'active' : ''}`}
                                    onClick={() => setFilterProvider('all')}
                                >
                                    All
                                </button>
                                <button 
                                    className={`btn ${filterProvider === 'Render' ? 'active' : ''}`}
                                    onClick={() => setFilterProvider('Render')}
                                >
                                    Render
                                </button>
                                <button 
                                    className={`btn ${filterProvider === 'Akash' ? 'active' : ''}`}
                                    onClick={() => setFilterProvider('Akash')}
                                >
                                    Akash
                                </button>
                                <button 
                                    className={`btn ${filterProvider === 'io.net' ? 'active' : ''}`}
                                    onClick={() => setFilterProvider('io.net')}
                                >
                                    io.net
                                </button>
                                <button 
                                    className={`btn ${filterProvider === 'Vast.ai' ? 'active' : ''}`}
                                    onClick={() => setFilterProvider('Vast.ai')}
                                >
                                    Vast.ai
                                </button>
                            </div>
                            
                            <div className="control-group">
                                <label>Sort:</label>
                                <button 
                                    className={`btn ${sortBy === 'price' ? 'active' : ''}`}
                                    onClick={() => setSortBy('price')}
                                >
                                    Price
                                </button>
                                <button 
                                    className={`btn ${sortBy === 'uptime' ? 'active' : ''}`}
                                    onClick={() => setSortBy('uptime')}
                                >
                                    Uptime
                                </button>
                                <button 
                                    className={`btn ${sortBy === 'vram' ? 'active' : ''}`}
                                    onClick={() => setSortBy('vram')}
                                >
                                    VRAM
                                </button>
                            </div>

                            <button 
                                className="btn refresh" 
                                onClick={refreshData}
                                disabled={refreshing}
                            >
                                {refreshing ? 'üîÑ Refreshing...' : 'üîÑ Refresh Prices'}
                            </button>
                        </div>
                    </div>

                    {arbitrage.length > 0 && (
                        <>
                            <div className="section-title">üìà Top Arbitrage Opportunities</div>
                            {arbitrage.slice(0, 3).map((arb, i) => (
                                <ArbitrageCard key={i} opportunity={arb} />
                            ))}
                        </>
                    )}

                    <div className="section-title">üíª Available GPUs ({filteredGpus.length})</div>
                    
                    <div className="gpu-grid">
                        {filteredGpus.length === 0 ? (
                            <div className="empty">
                                No GPUs found. Click "Refresh Prices" or run the backend engine (python3 main.py) to populate data.
                            </div>
                        ) : (
                            filteredGpus.map((gpu, i) => (
                                <GPUCard key={i} gpu={gpu} />
                            ))
                        )}
                    </div>
                </div>
            );
        }

        function GPUCard({ gpu }) {
            return (
                <div className="gpu-card">
                    <div className="gpu-header">
                        <div>
                            <div className="gpu-model">{gpu.gpu_model}</div>
                            <div className="gpu-vram">{gpu.vram_gb}GB VRAM</div>
                        </div>
                        <div className="price-badge">
                            <div className="price-main">${gpu.total_price.toFixed(2)}</div>
                            <div className="price-sub">/hour</div>
                        </div>
                    </div>

                    <div className="gpu-details">
                        <div className="detail-item">
                            <div className="detail-label">Provider</div>
                            <div className="detail-value">
                                <span className="provider-badge">{gpu.provider}</span>
                            </div>
                        </div>
                        <div className="detail-item">
                            <div className="detail-label">Location</div>
                            <div className="detail-value">{gpu.location}</div>
                        </div>
                        <div className="detail-item">
                            <div className="detail-label">Uptime</div>
                            <div className="detail-value">{gpu.uptime_percent.toFixed(1)}%</div>
                        </div>
                        <div className="detail-item">
                            <div className="detail-label">Status</div>
                            <div className="detail-value">
                                <span className={`availability ${gpu.availability.toLowerCase()}`}>
                                    {gpu.availability}
                                </span>
                            </div>
                        </div>
                    </div>

                    <div className="price-breakdown">
                        <div className="breakdown-row">
                            <span>Base Price:</span>
                            <span>${gpu.price_per_hour.toFixed(2)}/hr</span>
                        </div>
                        <div className="breakdown-row">
                            <span>Provider Fee ({gpu.provider}):</span>
                            <span>${gpu.provider_fee.toFixed(2)}/hr</span>
                        </div>
                        <div className="breakdown-row">
                            <span>GP4U Fee (1%):</span>
                            <span>${gpu.gp4u_fee.toFixed(2)}/hr</span>
                        </div>
                        <div className="breakdown-row total">
                            <span>Total Price:</span>
                            <span>${gpu.total_price.toFixed(2)}/hr</span>
                        </div>
                    </div>

                    <div className="gpu-actions">
                        <button className="action-btn deploy">Deploy Now</button>
                        <button className="action-btn compare">Compare Prices</button>
                    </div>
                </div>
            );
        }

        function ArbitrageCard({ opportunity }) {
            return (
                <div className="arbitrage-card">
                    <div className="arbitrage-header">{opportunity.gpu_model}</div>
                    <div className="arbitrage-compare">
                        <div className="arbitrage-provider cheap">
                            <div className="arbitrage-name">‚úÖ {opportunity.cheapest_provider}</div>
                            <div className="arbitrage-price">${opportunity.cheapest_price.toFixed(2)}/hr</div>
                        </div>
                        <div className="arbitrage-arrow">‚Üí</div>
                        <div className="arbitrage-provider expensive">
                            <div className="arbitrage-name">‚ùå {opportunity.expensive_provider}</div>
                            <div className="arbitrage-price">${opportunity.expensive_price.toFixed(2)}/hr</div>
                        </div>
                    </div>
                    <div className="arbitrage-savings">
                        üí∞ Save {opportunity.savings_percent.toFixed(1)}% (${opportunity.savings_amount.toFixed(2)}/hr)
                    </div>
                </div>
            );
        }

        ReactDOM.render(<GP4UDashboard />, document.getElementById('root'));
    </script>
</body>
</html>